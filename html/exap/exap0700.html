<article class="exap0700 view-code" >
	<h1>팝업 입력(C) 조회(R) 수정(U) 삭제(D) 예제</h1>
	<div class="intro">
		<p class="smallContTit">목록 화면과 입력 조회 수정 팝업을 조합한 예제 입니다.</p>
		<p class="smallContTit">팝업의 폼과 부모페이지의 그리드는 같은 데이터를 참고하고 있으므로 둘중 한쪽에서 데이터 변동이 있을 시 나머지 한쪽도 실시간으로 변경된 데이터가 동기화 됩니다.</p>
		<p class="smallContTit">서버와 연계되지 않은 UI 쪽 코딩 예제 입니다. 때문에 검색 조건으로 입력한 데이터는 그리드에 적용되지 않습니다. 서버쪽으로 전달되는 파라미터만 확인 바랍니다.</p>
	</div>

	<div id="subContext">
		<div class="searchBox">
			<ul>
				<li class="inputs">
					<label>Name<input id="name" type="text" data-validate='[["alphabet+integer"]]' /></label>
					<label>Gender<input id="gender" type="radio" /></label>
					<label>Eye Color<select id="eyeColor"><option>선택</option></select></label>
				</li>
				<li class="buttons">
					<a id="btnSave" href="#" data-opts='{ "color" : "gray" }'>저장</a>
					<a id="btnSearch" href="#">조회</a>
				</li>
			</ul>
		</div>

		<table id="grid" class="grid" style="width: 100%;">
			<thead>
				<tr>
					<th width="7%" data-rowspan="true">Age</th>
					<th width="11%" data-rowspan="true">Gender</th>
					<th width="13%" data-rowspan="true">Eye Color</th>
					<th width="12%" data-rowspan="true">Active</th>
					<th width="13%">Company</th>
					<th width="17%">Name</th>
					<th width="*">Email</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td id="age"></td>
					<td id="gender" align="center"></td>
					<td id="eyeColor" align="center"></td>
					<td id="isActive" align="center"></td>
					<td id="company"></td>
					<td id="name"></td>
					<td id="email"></td>
				</tr>
			</tbody>
		</table>
	</div>
</article>

<script type="text/javascript">
N(".exap0700").cont({
	genderCodes : [{
     	"key" : "male",
     	"val" : "male"
     },{
     	"key" : "female",
     	"val" : "female"
    }],
	eyeColorCodes : [{
     	"key" : "blue",
     	"val" : "blue"
     },{
     	"key" : "brown",
     	"val" : "brown"
     },{
     	"key" : "green",
     	"val" : "green"
	}],
    init : function(view, request) {
    	// 1. initialize buttons
    	N(".buttons a", view).button();

    	// 2. initialize N.select and bind data for search box inputs
    	// 2-1. create #gender select
		N(this.genderCodes).select(N("div.searchBox li.inputs #gender", view)).bind();
		// 2-2. create #eyeColor select
		N(this.eyeColorCodes).select(N("div.searchBox li.inputs #eyeColor", view)).bind();

    	// 3. initialize N.form and add new row data for search box
    	var form = N([]).form({
    		context : N("div.searchBox li.inputs", view)
    	}).add();

    	// 4. initialize N.grid and bind empty data for data list
    	var this_ = this;
    	var grid = N([]).grid({
       		context : N("#grid", view),
       		data : [],
       		height : 350,
       		resizable : true,
       		sortable : true,
       		hover : true,
       		select : true,
       		unselect : false,
       		onSelect : function(index, rowEle, data) {
       			// Grid row select event
       			// 5. initialize and open detail popup;
       			if(index > -1) {
	       			N().popup({
	       	    		url : "html/exap/exap0701.html",
	       	    		title : "상세",
	       	    		alwaysOnTop : true,
	       	    		button : false,
	       	    		width : 560,
	       	    		height : 610,
	       	    		closeMode : "remove",
	       	    		onOpen : "onOpen",
	       	    		opener : this_
	       	    	}).open({
	       	    		grid : grid,
	       				data : data,
	       				row : index
	       			});
       			}
        	},
        	filter : true
       	});

    	// 6. bind events
    	// 6-1. Save button
    	N("#btnSave", view).click(function(e) {
    		e.preventDefault();

            if(grid.data("modified").length === 0) {
            	N(window).alert("변경된 데이터가 없습니다.").show();
            	return false;
            }

            if(grid.validate()) {
            	N(window).alert({
            		msg : "저장 하시겠습니까?",
            		confirm : true,
            		onOk : function() {
            			N(window).alert({
                 			title : "서버로 전송되는 파라미터",
                 			msg : "<pre style='width: 450px; height: 400px; overflow: auto;'>" + N.json.format(grid.data("modified")).replace(/\\/g, "") + "</pre>"
                 		}).show();
            		}
            	}).show();
            }
    	});
    	// 6-2. Search button
    	N("#btnSearch", view).click(function(e) {
            e.preventDefault();
            if(form.validate()) {
    			N(form.data()).comm("html/apid/data/grid_age_sorted.json").submit(function(data) {
             		// Data bind to N.grid
             		grid.bind(data);
             	});
            }
        }).click(); // Auto retrieve
    }
});
</script>