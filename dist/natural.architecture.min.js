/*
 Natural-ARCHITECTURE v1.0.0

 Released under the LGPL v2.1 license
 Date: 2014-09-26T11:11Z

 Copyright 2023 KIM HWANG MAN(bbalganjjm@gmail.com)
*/
(function(x,f){N.version["Natural-ARCHITECTURE"]="1.0.0";f.fn.extend(f.extend(N.prototype,{ajax:function(d){return N.ajax(d)},comm:function(d){return new N.comm(this,d)},request:function(){return this.get(0).request},cont:function(d){return new N.cont(this,d)}}));(function(d){d.ajax=f.ajax;var u,t=d.comm=function(a,b){if(void 0===a)throw d.error("[N.comm]You must input arguments[0]");(d.isPlainObject(a)||d.isString(a))&&void 0===b&&(b=a,a=f());if(d.isPlainObject(a)||d.isArray(a))a=f(a);void 0===u&&
(u=t.initFilterConfig());var l=!1;f(u.beforeInitFilters).each(function(c){if((c=this(a))instanceof Error)return l=!0,!1;void 0!==c&&(a=f(c))});if(l)return a;a.request=new t.request(a,d.isString(b)?{url:b}:b);a.errorHandlers=[];f(f.map(t,function(c,k){if("function"===typeof t[k]&&"request"!==k)return k})).each(function(c,k){a[k]=function(m){return t[k].call(a,m)}});return a};f.extend(t,{xhr:null,initFilterConfig:function(){var a=[],b=[],l=[],c=[],k=[],m=[],e=d.context.attr("architecture").comm.filters,
h=[],g=d.context.attr("core").spltSepa,q;for(q in e)void 0!==e[q].order&&h.push(e[q].order+g+q);h.sort();for(q in e)void 0===e[q].order&&h.push(q);f(h).each(function(){var n=this.split(g);n=1<n.length?n[1]:n[0];for(var p in e[n])"beforeInit"===p?a.push(e[n][p]):"afterInit"===p?b.push(e[n][p]):"beforeSend"===p?l.push(e[n][p]):"success"===p?c.push(e[n][p]):"error"===p?k.push(e[n][p]):"complete"===p&&m.push(e[n][p])});return{beforeInitFilters:a,afterInitFilters:b,beforeSendFilters:l,successFilters:c,
errorFilters:k,completeFilters:m}},resetFilterConfig:function(){u=t.initFilterConfig();return this},submit:function(a){var b=this;d.isElement(b)&&(f.extend(this.request.options,{contentType:"text/html; charset=UTF-8",dataType:"html",type:"GET"}),this.request.options.target=b);var l=!1;f(u.afterInitFilters).each(function(c){if(this(b.request)instanceof Error)return l=!0,!1});if(!l)return f.extend(b.request.options,{beforeSend:function(c,k){var m=!1;f(u.beforeSendFilters).each(function(e,h){if(h.call(b,
b.request,c,k)instanceof Error)return m=!0,!1});if(m)return!1},success:function(c,k,m){var e=!1;f(u.successFilters).each(function(g,q){g=q.call(b,b.request,c,k,m);if(g instanceof Error)return e=!0,!1;void 0!==g&&(c=g)});if(e)return!1;if(d.isElement(b)){if(b.is(d.context.attr("architecture").page.context))d.gc[d.context.attr("core").gcMode]();b.request.options.append?b.append(c):b.request.options.replace?(b.attr("id",b.attr("id")+"_pending_to_remove"),b.css("display","none"),b.after(c)):b.html(c);
b.is(d.context.attr("architecture").page.context)||d.gc.ds();if(b.request.options.replace){if(0<b.nextAll(".view_context__:first").length){var h=b.nextAll(".view_context__:first").instance("cont");void 0!==h&&v.trInit.call(this,h,b.request)}b.remove()}else 0<b.children(".view_context__:last").length&&(h=b.children(".view_context__:last").instance("cont"),void 0!==h&&v.trInit.call(this,h,b.request))}else if(b.request.options.urlSync&&b.request.options.referrer.replace(/!/g,"")!=x.location.href.replace(/!/g,
""))return m.abort(),d.warn("[Communicator.submit.success(urlSync option)]The response was stopped because it was different from the URL at the time of the request and the URL at the time of the response."),!1;if(void 0!==a)try{d.isElement(b)?a.call(b,h):a.call(b,c,b.request),h=void 0}catch(g){throw 0<b.errorHandlers.length&&f(b.errorHandlers).each(function(q,n){n.call(b,m,k,g,b.request,a)}),d.error("N.comm.submit.success.callback(url:"+b.request.options.url+")",g);}},error:function(c,k,m){var e=
!1;f(u.errorFilters).each(function(h,g){if(g.call(b,b.request,c,k,m)instanceof Error)return e=!0,!1});if(!e)if(0<b.errorHandlers.length)f(b.errorHandlers).each(function(h,g){g.call(b,m,b.request,c,k)});else throw d.error("N.comm.submit.error(url:"+b.request.options.url+")",m);},complete:function(c,k){f(u.completeFilters).each(function(m,e){if(e.call(b,b.request,c,k)instanceof Error)return!1})}}),this.xhr=d.ajax(b.request.options),a?b:this.xhr},error:function(a){this.errorHandlers.push(a);return this}});
t.request=function(a,b){this.options={referrer:x.location.href,contentType:"application/json; charset=utf-8",cache:!1,async:!0,type:"POST",data:null,dataIsArray:!1,dataType:"json",urlSync:!0,crossDomain:!1,browserHistory:!0,append:!1,target:null};try{f.extend(this.options,d.context.attr("architecture").comm.request.options)}catch(l){}f.extend(this.options,b);this.attrObj={};this.obj=a;if(null===this.options.data){if(d.isWrappedSet(a)){if(!d.isElement(a))try{if(this.options.data=this.options.dataIsArray?
a.get():a.get(0),this.options.dataIsArray&&"array"===d.type(this.options.data)||"object"===d.type(this.options.data))this.options.data=JSON.stringify(this.options.data)}catch(l){this.options.data=null}}else if(null!=a)try{this.options.data=a,"object"===d.type(this.options.data)&&(this.options.data=JSON.stringify(a))}catch(l){this.options.data=null}null!=this.options.data&&"GET"===this.options.type.toUpperCase()&&(a=this.options.data.charAt(0),b=this.options.data.charAt(this.options.data.length-1),
"{"===a&&"}"===b||"["===a&&"]"===b)&&(this.options.data="q="+encodeURI(this.options.data))}};f.fn.extend(t.request.prototype,{attr:function(a,b){if(void 0===a)return this.attrObj;if(void 0===b)return void 0!==this.attrObj&&void 0!==this.attrObj[a]?this.attrObj[a]:void 0;void 0===this.attrObj&&(this.attrObj={});this.attrObj[a]=b;return this.obj},removeAttr:function(a){void 0!==this.attrObj[a]&&delete this.attrObj[a];return this},param:function(a){if(d.isEmptyObject(a)){if(0>this.options.url.indexOf("?"))return{};
a={};for(var b=this.options.url.split("?")[1].split("&"),l=0;l<b.length;l++){var c=b[l].split("=");c[0]&&(a[c[0]]=decodeURIComponent(c[1])||!0)}return a}return this.param()[a]},get:function(a){return void 0!==a?this.options[a]:this.options},reload:function(a){var b=this.options.target.comm(this.options.url);b.request=this;b.submit(a);return this}});var v=d.cont=function(a,b){if(void 0!==a.attr("id")&&1<d("[id='"+a.attr("id")+"']").length)a=d("#"+a.attr("id")+":not([data-pageid])");else{var l=a.selector;
1<a.length&&(a=d(a.selector+":not([data-pageid])"),a.selector=l)}a.attr("data-pageid",a.attr("id")?a.attr("id"):a.selector.replace(/\.|#|\[|\]|'|:|\(|\)|>| |\-/gi,""));a.addClass("view_context__");a.instance("cont",b);b.view=a;return b};f.extend(v,{trInit:function(a,b){a.request=b;v.aop.wrap.call(this,a);void 0!==a.init&&a.init(a.view,b)},aop:{pointcuts:{regexp:{fn:function(a,b,l){return(a instanceof RegExp?a:new RegExp(a)).test(l)}}},wrap:function(a){if(d.context.attr("architecture").cont&&d.context.attr("architecture").cont.advisors&&
0<d.context.attr("architecture").cont.advisors.length){var b=d.context.attr("architecture").cont;f(b.advisors).each(function(l,c){d.isPlainObject(c.pointcut)||(c.pointcut={type:"regexp",param:c.pointcut},d.isString(c.pointcut.param)&&(c.pointcut.selector=c.pointcut.selector||c.pointcut.param.substring(0,c.pointcut.param.lastIndexOf(":")),c.pointcut.param=c.pointcut.param.substring(c.pointcut.param.lastIndexOf(":")+1)));var k=b.pointcuts?b.pointcuts[c.pointcut.type]||v.aop.pointcuts[c.pointcut.type]:
v.aop.pointcuts[c.pointcut.type];if(!k)throw d.error("[N.cont.aop.wrap]Unkown pointcut type : "+c.pointcut.type);if(!c.pointcut.selector||a.view.is(c.pointcut.selector)){var m=function(e,h){for(var g in e)e.hasOwnProperty(g)&&("function"===typeof e[g]?k.fn(c.pointcut.param,e,h+g)&&(e[g]=function(q,n){switch(c.adviceType){case "before":var p=function(){var r=[].slice.call(arguments);c.fn.call(c,e,h+n,r);return q.apply(e,r)};break;case "after":p=function(){var r=[].slice.call(arguments),w=q.apply(e,
r);c.fn.call(c,e,h+n,r,w);return w};break;case "around":p=function(){var r=[].slice.call(arguments);return c.fn.call(c,e,h+n,r,{contFrag:e,args:r,real:q,proceed:function(){return this.real.apply(this.contFrag,this.args)}})};break;case "error":p=function(){var r=[].slice.call(arguments);try{var w=q.apply(e,r)}catch(y){if("error"===c.adviceType)w=c.fn.call(c,e,h+n,r,y);else throw y;}return w}}return p}(e[g],g)):d.isPlainObject(e[g])&&m.call(this,e[g],h+g+"."))};m.call(this,a,"")}})}}}});d.context={attrObj:{},
attr:t.request.prototype.attr}})(N)})(window,jQuery);
