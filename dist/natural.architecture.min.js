/*
 Natural-ARCHITECTURE v0.15.12

 Released under the LGPL v2.1 license
 Date: 2014-09-26T11:11Z

 Copyright 2023 KIM HWANG MAN(bbalganjjm@gmail.com)
*/
(function(x,h){N.version["Natural-ARCHITECTURE"]="0.14.12";h.fn.extend(h.extend(N.prototype,{ajax:function(c){return N.ajax(c)},comm:function(c){return new N.comm(this,c)},request:function(){return this.get(0).request},cont:function(c){return new N.cont(this,c)}}));(function(c){c.ajax=h.ajax;var r,u=c.comm=function(a,b){if(void 0===a)throw c.error("[N.comm]You must input arguments[0]");(c.isPlainObject(a)||c.isString(a))&&void 0===b&&(b=a,a=h());if(c.isPlainObject(a)||c.isArray(a))a=h(a);void 0===
r&&(r=u.initFilterConfig());var n=!1;h(r.beforeInitFilters).each(function(d){if((d=this(a))instanceof Error)return n=!0,!1;void 0!==d&&(a=h(d))});if(n)return a;a.request=new u.request(a,c.isString(b)?{url:b}:b);a.errorHandlers=[];h(h.map(u,function(d,f){if("function"===typeof u[f]&&"request"!==f)return f})).each(function(d,f){a[f]=function(l){return u[f].call(a,l)}});return a};h.extend(u,{xhr:null,initFilterConfig:function(){var a=[],b=[],n=[],d=[],f=[],l=[],e=c.context.attr("architecture").comm.filters,
k=[],g=c.context.attr("core").spltSepa,m;for(m in e)void 0!==e[m].order&&k.push(e[m].order+g+m);k.sort();for(m in e)void 0===e[m].order&&k.push(m);h(k).each(function(){var p=this.split(g);p=1<p.length?p[1]:p[0];for(var q in e[p])"beforeInit"===q?a.push(e[p][q]):"afterInit"===q?b.push(e[p][q]):"beforeSend"===q?n.push(e[p][q]):"success"===q?d.push(e[p][q]):"error"===q?f.push(e[p][q]):"complete"===q&&l.push(e[p][q])});return{beforeInitFilters:a,afterInitFilters:b,beforeSendFilters:n,successFilters:d,
errorFilters:f,completeFilters:l}},resetFilterConfig:function(){r=u.initFilterConfig();return this},submit:function(a){var b=this;c.isElement(b)&&(h.extend(this.request.options,{contentType:"text/html; charset=UTF-8",dataType:"html",type:"GET"}),this.request.options.target=b);var n=!1;h(r.afterInitFilters).each(function(d){if(this(b.request)instanceof Error)return n=!0,!1});if(!n)return h.extend(b.request.options,{beforeSend:function(d,f){var l=!1;h(r.beforeSendFilters).each(function(e,k){if(k.call(b,
b.request,d,f)instanceof Error)return l=!0,!1});if(l)return!1},success:function(d,f,l){var e=!1;h(r.successFilters).each(function(g,m){g=m.call(b,b.request,d,f,l);if(g instanceof Error)return e=!0,!1;void 0!==g&&(d=g)});if(e)return!1;if(c.isElement(b)){if(b.is(c.context.attr("architecture").page.context))c.gc[c.context.attr("core").gcMode]();b.request.options.append?b.append(d):b.request.options.replace?(b.attr("id",b.attr("id")+"_pending_to_remove"),b.css("display","none"),b.after(d)):b.html(d);
b.is(c.context.attr("architecture").page.context)||c.gc.ds();if(b.request.options.replace){if(0<b.nextAll(".view_context__:first").length){var k=b.nextAll(".view_context__:first").instance("cont");void 0!==k&&v.trInit.call(this,k,b.request)}b.remove()}else 0<b.children(".view_context__:last").length&&(k=b.children(".view_context__:last").instance("cont"),void 0!==k&&v.trInit.call(this,k,b.request))}else if(b.request.options.urlSync&&b.request.options.referrer.replace(/!/g,"")!=x.location.href.replace(/!/g,
""))return l.abort(),c.warn("[Communicator.submit.success(urlSync option)]The response was stopped because it was different from the URL at the time of the request and the URL at the time of the response."),!1;if(void 0!==a)try{c.isElement(b)?a.call(b,k):a.call(b,d,b.request),k=void 0}catch(g){throw 0<b.errorHandlers.length&&h(b.errorHandlers).each(function(m,p){p.call(b,g,b.request,l,f,a)}),c.error("N.comm.submit.success.callback(url:"+b.request.options.url+")",g);}},error:function(d,f,l){var e=
!1;h(r.errorFilters).each(function(k,g){if(g.call(b,b.request,d,f,l)instanceof Error)return e=!0,!1});if(!e)throw 0<b.errorHandlers.length&&h(b.errorHandlers).each(function(k,g){g.call(b,l,b.request,d,f)}),c.error("N.comm.submit.error(url:"+b.request.options.url+")",l);},complete:function(d,f){h(r.completeFilters).each(function(l,e){if(e.call(b,b.request,d,f)instanceof Error)return!1})}}),this.xhr=c.ajax(b.request.options),b},fetch:function(){var a=this;return new Promise((b,n)=>{c.isElement(a)&&
(h.extend(this.request.options,{contentType:"text/html; charset=UTF-8",dataType:"html",type:"GET"}),this.request.options.target=a);var d=!1;h(r.afterInitFilters).each(function(f){if(this(a.request)instanceof Error)return d=!0,!1});if(!d)return h.extend(a.request.options,{beforeSend:function(f,l){var e=!1;h(r.beforeSendFilters).each(function(k,g){if(g.call(a,a.request,f,l)instanceof Error)return e=!0,!1});if(e)return!1},success:function(f,l,e){var k=!1;h(r.successFilters).each(function(m,p){m=p.call(a,
a.request,f,l,e);if(m instanceof Error)return k=!0,!1;void 0!==m&&(f=m)});if(k)return!1;if(c.isElement(a)){if(a.is(c.context.attr("architecture").page.context))c.gc[c.context.attr("core").gcMode]();a.request.options.append?a.append(f):a.request.options.replace?(a.attr("id",a.attr("id")+"_pending_to_remove"),a.css("display","none"),a.after(f)):a.html(f);a.is(c.context.attr("architecture").page.context)||c.gc.ds();if(a.request.options.replace){if(0<a.nextAll(".view_context__:first").length){var g=a.nextAll(".view_context__:first").instance("cont");
void 0!==g&&v.trInit.call(this,g,a.request)}a.remove()}else 0<a.children(".view_context__:last").length&&(g=a.children(".view_context__:last").instance("cont"),void 0!==g&&v.trInit.call(this,g,a.request))}else if(a.request.options.urlSync&&a.request.options.referrer.replace(/!/g,"")!=x.location.href.replace(/!/g,""))return e.abort(),c.warn("[Communicator.submit.success(urlSync option)]The response was stopped because it was different from the URL at the time of the request and the URL at the time of the response."),
!1;try{c.isElement(a)?b.call(a,g):b.call(a,f,a.request),g=void 0}catch(m){0<a.errorHandlers.length&&h(a.errorHandlers).each(function(p,q){q.call(a,m,a.request,e,l,callback)}),n(m)}},error:function(f,l,e){var k=!1;h(r.errorFilters).each(function(g,m){if(m.call(a,a.request,f,l,e)instanceof Error)return k=!0,!1});if(!k)throw 0<a.errorHandlers.length&&h(a.errorHandlers).each(function(g,m){m.call(a,e,a.request,f,l)}),c.error("N.comm.submit.error(url:"+a.request.options.url+")",e);},complete:function(f,
l){h(r.completeFilters).each(function(e,k){if(k.call(a,a.request,f,l)instanceof Error)return!1})}}),this.xhr=c.ajax(a.request.options),a})},error:function(a){this.errorHandlers.push(a);return this}});u.request=function(a,b){this.options={referrer:x.location.href,contentType:"application/json; charset=utf-8",cache:!1,async:!0,type:"POST",data:null,dataIsArray:!1,dataType:"json",urlSync:!0,crossDomain:!1,browserHistory:!0,append:!1,target:null};try{h.extend(this.options,c.context.attr("architecture").comm.request.options)}catch(n){}h.extend(this.options,
b);this.attrObj={};this.obj=a;if(null===this.options.data){if(c.isWrappedSet(a)){if(!c.isElement(a))try{if(this.options.data=this.options.dataIsArray?a.get():a.get(0),this.options.dataIsArray&&"array"===c.type(this.options.data)||"object"===c.type(this.options.data))this.options.data=JSON.stringify(this.options.data)}catch(n){this.options.data=null}}else if(null!=a)try{this.options.data=a,"object"===c.type(this.options.data)&&(this.options.data=JSON.stringify(a))}catch(n){this.options.data=null}null!=
this.options.data&&"GET"===this.options.type.toUpperCase()&&(a=this.options.data.charAt(0),b=this.options.data.charAt(this.options.data.length-1),"{"===a&&"}"===b||"["===a&&"]"===b)&&(this.options.data="q="+encodeURI(this.options.data))}};h.fn.extend(u.request.prototype,{attr:function(a,b){if(void 0===a)return this.attrObj;if(void 0===b)return void 0!==this.attrObj&&void 0!==this.attrObj[a]?this.attrObj[a]:void 0;void 0===this.attrObj&&(this.attrObj={});this.attrObj[a]=b;return this.obj},removeAttr:function(a){void 0!==
this.attrObj[a]&&delete this.attrObj[a];return this},param:function(a){if(c.isEmptyObject(a)){if(0>this.options.url.indexOf("?"))return{};a={};for(var b=this.options.url.split("?")[1].split("&"),n=0;n<b.length;n++){var d=b[n].split("=");d[0]&&(a[d[0]]=decodeURIComponent(d[1])||!0)}return a}return this.param()[a]},get:function(a){return void 0!==a?this.options[a]:this.options},reload:function(a){var b=this.options.target.comm(this.options.url);b.request=this;b.submit(a);return this}});var v=c.cont=
function(a,b){if(void 0!==a.attr("id")&&1<c("[id='"+a.attr("id")+"']").length)a=c("#"+a.attr("id")+":not([data-pageid])");else{var n=a.selector;1<a.length&&(a=c(a.selector+":not([data-pageid])"),a.selector=n)}a.attr("data-pageid",a.attr("id")?a.attr("id"):a.selector.replace(/\.|#|\[|\]|'|:|\(|\)|>| |\-/gi,""));a.addClass("view_context__");a.instance("cont",b);b.view=a;return b};h.extend(v,{trInit:function(a,b){a.request=b;v.aop.wrap.call(this,a);void 0!==a.init&&a.init(a.view,b)},aop:{pointcuts:{regexp:{fn:function(a,
b,n){return(a instanceof RegExp?a:new RegExp(a)).test(n)}}},wrap:function(a){if(c.context.attr("architecture").cont&&c.context.attr("architecture").cont.advisors&&0<c.context.attr("architecture").cont.advisors.length){var b=c.context.attr("architecture").cont;h(b.advisors).each(function(n,d){c.isPlainObject(d.pointcut)||(d.pointcut={type:"regexp",param:d.pointcut},c.isString(d.pointcut.param)&&(d.pointcut.selector=d.pointcut.selector||d.pointcut.param.substring(0,d.pointcut.param.lastIndexOf(":")),
d.pointcut.param=d.pointcut.param.substring(d.pointcut.param.lastIndexOf(":")+1)));var f=b.pointcuts?b.pointcuts[d.pointcut.type]||v.aop.pointcuts[d.pointcut.type]:v.aop.pointcuts[d.pointcut.type];if(!f)throw c.error("[N.cont.aop.wrap]Unkown pointcut type : "+d.pointcut.type);if(!d.pointcut.selector||a.view.is(d.pointcut.selector)){var l=function(e,k){for(var g in e)e.hasOwnProperty(g)&&("function"===typeof e[g]?f.fn(d.pointcut.param,e,k+g)&&(e[g]=function(m,p){switch(d.adviceType){case "before":var q=
function(){var t=[].slice.call(arguments);d.fn.call(d,e,k+p,t);return m.apply(e,t)};break;case "after":q=function(){var t=[].slice.call(arguments),w=m.apply(e,t);d.fn.call(d,e,k+p,t,w);return w};break;case "around":q=function(){var t=[].slice.call(arguments);return d.fn.call(d,e,k+p,t,{contFrag:e,args:t,real:m,proceed:function(){return this.real.apply(this.contFrag,this.args)}})};break;case "error":q=function(){var t=[].slice.call(arguments);try{var w=m.apply(e,t)}catch(y){if("error"===d.adviceType)w=
d.fn.call(d,e,k+p,t,y);else throw y;}return w}}return q}(e[g],g)):c.isPlainObject(e[g])&&l.call(this,e[g],k+g+"."))};l.call(this,a,"")}})}}}});c.context={attrObj:{},attr:u.request.prototype.attr}})(N)})(window,jQuery);
