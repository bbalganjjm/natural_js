/*
 Natural-TEMPLATE v0.1.11

 Released under the LGPL v2.1 license
 Date: 2019-02-28T18:00Z

 Copyright 2019 KIM HWANG MAN(bbalganjjm@gmail.com)
*/
(function(x,r){N.version["Natural-TEMPLATE"]="0.1.11";(function(b){var u=b.template={aop:{codes:function(a,h,f){var e={codeUrl:null,codeKey:null};try{r.extend(!0,e,b.context.attr("template").aop.codes)}catch(g){throw b.error("N.tab",g);}r.extend(!0,e,f);var l=[];f=[];var q=[];for(d in a)"string"===b.type(d)&&b.string.startsWith(d,"p.select.")&&("array"===b.type(a[d])&&0<a[d].length&&(a[d]=2<a[d].length?{comm:a[d][0],key:a[d][1],val:a[d][2],filter:a[d][3]}:{code:a[d][0],filter:a[d][1]}),a[d].code?
l.push(d.split(".")[2]+"|"+a[d].code):a[d].comm?f.push(d.split(".")[2]+"|"+a[d].comm):q.push(d.split(".")[2]+"|select__"));0<q.length&&b(q).each(function(g,k){g=k.split("|");var m=a["p.select."+g[0]];if(m.data)a["p.select."+g[0]]=b("[id='"+g[0]+"']",a.view).filter("select,input[type='checkbox'],input[type='radio']").map(function(p,n){m.context=n;m.filter&&(m.data=m.filter(m.data));p=b().select(m).bind();m.selected&&p.val(m.selected);return p}).get();else throw b.error(b.message.get(b.context.attr("template").message,
"MSG-0001"));});if(0<l.length||0<f.length){var c=[];if(0<l.length){var d=b(l).map(function(g,k){return k.split("|")[1]}).get();c.push(b({codes:null!=d&&0===d.length?void 0:d}).comm({url:e.codeUrl}).submit(function(g){b(l).each(function(k,m){var p=m.split("|"),n=a["p.select."+p[0]];a["p.select."+p[0]]=b("[id='"+p[0]+"']",a.view).filter("select,input[type='checkbox'],input[type='radio']").map(function(t,v){n.context=v;t=r.grep(g,function(w){return w[e.codeKey]===p[1]});t=b(n.filter?n.filter(t):t).select(n).bind();
n.selected&&t.val(n.selected);return t}).get()})}).error(function(g){b.warn(g);throw b.error(b.message.get(b.context.attr("template").message,"MSG-0002"));}).request.obj.xhr)}b(f).each(function(g,k){var m=k.split("|");if(!a[m[1]])throw b.error(b.message.get(b.context.attr("template").message,"MSG-0003",[m[1]]));c.push(a[m[1]]().submit(function(p){var n=a["p.select."+m[0]];a["p.select."+m[0]]=b("[id='"+m[0]+"']",a.view).filter("select,input[type='checkbox'],input[type='radio']").map(function(t,v){n.context=
v;t=b(n.filter?n.filter(p):p).select(n).bind();n.selected&&t.val(n.selected);return t}).get()}).error(function(p){b.warn(p);throw b.error(b.message.get(b.context.attr("template").message,"MSG-0004",[m[0]]));}).request.obj.xhr)});r.when.apply(r,c).done(function(){u.aop.template(a,h)})}else u.aop.template(a,h)},template:function(a,h){var f=[],e;for(e in a)"string"===b.type(e)&&b.string.startsWith(e,"p.")&&u.aop.components(a,e,f);for(e in a)"string"===b.type(e)&&b.string.startsWith(e,"e.")&&u.aop.events(a,
e);0<f.length&&(r(f).each(function(){this.resolve()}),f=void 0);h.proceed();setTimeout(function(){a.onOpenDefer&&a.onOpenDefer.resolve()},0)},components:function(a,h,f){var e=h.split(".");if(2<e.length){var l="p."+e[1]+"."+e[2],q=b("#"+e[2],a.view),c=a[l];void 0!==c&&void 0!==c.context&&(q=b(c.context,a.view));"popup"===e[1]&&"file"===e[2]&&(c.url="file/manager.view",c.top=20,c.onOpen="onOpen",c.overlayClose=!1,c.escClose=!1);if(void 0===c||0===q.length&&void 0===c.context&&0===q.length&&void 0===
c.url)throw b.error(b.message.get(b.context.attr("template").message,"MSG-0005",[a.view.data("pageid")+":"+h]));c.context=q;"button"===e[1]||"popup"===e[1]||"tab"===e[1]||"datepicker"===e[1]?((c.url&&"popup"===e[1]||"tab"===e[1])&&void 0===c.opener&&(c.opener=a),a[l]=c.context[e[1]](c)):"select"===e[1]||c.code||(a[l]=b([])[e[1]](c));if(c.usage){var d={"search-box":{defaultButton:".btn-search",events:[]}};"object"===b.type(c.usage)&&r.extend(!0,d,c.usage);if("search-box"===c.usage||void 0!==d["search-box"]){void 0!==
c.action&&"add"===c.action||a[l].add();var g=[];h=d["search-box"].events;0<h.length&&r(h).each(function(){g.push(this.target);c.context.find(this.target).on(this.event+"."+a.view.data("pageid"),this.handler)});c.context.on("keyup."+a.view.data("pageid"),":input:not("+g.join(",")+")",function(k){13==(k.keyCode?k.keyCode:k.which?k.which:k.charCode)&&a.view.find(d["search-box"].defaultButton).trigger("click")});if(b.browser.is("ie"))c.context.on("keyup."+a.view.data("pageid"),":input",function(k){13==
(k.keyCode?k.keyCode:k.which?k.which:k.charCode)&&this.blur()})}}c.action&&f.push(r.Deferred().done(function(){if("string"===b.type(c.action))a[l][c.action]();else"array"===b.type(c.action)&&1<c.action.length&&a[l][c.action[0]].apply(a[l],c.action.splice(1))}))}else throw b.error(b.message.get(b.context.attr("template").message,"MSG-0005",[a.view.data("pageid")+":"+h]));},events:function(a,h){var f=h.split(".");if(2<f.length){var e=f[2],l="";if("function"===b.type(a[h])){f=f[1];var q=a[h];l="#"}else if("object"===
b.type(a[h]))f=a[h].target,q=a[h].handler;else throw b.error(b.message.get(b.context.attr("template").message,"MSG-0006",[a.view.data("pageid")+":"+h]));var c=b(l+f,a.view),d=c.closest(".list__, .grid__"),g;0<d.length&&0===c.closest("header").length?(d.hasClass("list__")?g=d.instance("list"):d.hasClass("grid__")&&(g=d.instance("grid")),g&&(c=g.tempRowEle.find(l+f),c.is(":radio, :checkbox")&&1<b("[name='"+f+"']",g.tempRowEle).length&&(c=b("[name='"+f+"']",g.tempRowEle)))):c.is(":radio, :checkbox")&&
1<b("[name='"+f+"']",a.view).length&&(c=b("[name='"+f+"']",a.view));c.is("a, button, input[type=button]")?c.button():e&&-1<e.indexOf("click")&&c.css("cursor","pointer");g?(l=c.is(":radio")||c.is(":checkbox")&&1<c.length?">.form__ [name='"+f+"']:radio, >.form__ [name='"+f+"']:checkbox":">.form__ "+l+f,a[h]=d.on(e+"."+a.view.data("pageid"),l,function(){var k=Array.apply(null,arguments);k.push(d.find(">.form__").index(r(this).closest(".form__")));q.apply(this,k)})):a[h]=c.on(e+"."+a.view.data("pageid"),
q)}else throw b.error(b.message.get(b.context.attr("template").message,"MSG-0006",[a.view.data("pageid")+":"+h]));}}}})(N)})(window,jQuery);
