# 개요

Communication Filter는 N.comm을 통해 서버와 통신하는 모든 요청과 응답 또는 에러 발생 단계에서 공통 로직을 실행할 수 있는 기능입니다.

필터의 선언은 [Config(natural.config.js)](config-overview.md)의 N.context.attr("architecture").comm.filters 객체의 속성에 정의할 수 있고 필터의 단계는 다음과 같습니다:

* **beforeInit**: N.comm이 초기화되기 전에 실행됩니다.
* **afterInit**: N.comm이 초기화된 후에 실행됩니다.
* **beforeSend**: 서버에 요청을 보내기 전에 실행됩니다.
* **success**: 서버에서 성공 응답이 전달됐을 때 실행됩니다.
* **error**: 서버에서 에러 응답이 전달됐을 때 실행됩니다.
* **complete**: 서버의 응답이 완료되면 실행됩니다.

> **참고**: N.comm 대신 jQuery.ajax를 사용하면 Communication Filter를 사용할 수 없습니다.

## Communication Filters의 목적

Communication Filters는 모든 서버 통신에 걸쳐 횡단 관심사(cross-cutting concerns)를 구현하는 강력한 방법을 제공합니다. 일반적인 사용 사례는 다음과 같습니다:

1. **인증**: 모든 요청에 인증 토큰 추가
2. **로깅**: 디버깅이나 분석을 위한 모든 서버 통신 로깅
3. **오류 처리**: 오류를 처리하는 일관된 방법 제공
4. **데이터 변환**: 서버로 보내기 전이나 서버에서 받은 후 데이터 형식 지정
5. **로딩 표시기**: 로딩 표시기 자동으로 표시 및 숨기기
6. **세션 관리**: 세션 만료 처리

## 필터 실행 흐름

다음 다이어그램은 Communication Filters의 실행 흐름을 보여줍니다:

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│                     애플리케이션 코드                            │
│                                                                 │
└───────────────────────────────┬─────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│                     N.comm 초기화                               │
│                                                                 │
└───────────────────────────────┬─────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                      Communication Filters                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────┐       ┌─────────────────┐                  │
│  │   beforeInit    │───────│    afterInit    │                  │
│  └─────────────────┘       └─────────────────┘                  │
│            │                        │                           │
│            │                        │                           │
│            ▼                        ▼                           │
│  ┌─────────────────┐       ┌─────────────────┐                  │
│  │   beforeSend    │───────│      서버       │                  │
│  └─────────────────┘       └─────────────────┘                  │
│                                    │                            │
│                                    │                            │
│                                    ▼                            │
│                    ┌───────────────────────────┐                │
│                    │                           │                │
│                    ▼                           ▼                │
│           ┌─────────────────┐       ┌─────────────────┐         │
│           │     success     │       │      error      │         │
│           └─────────────────┘       └─────────────────┘         │
│                    │                        │                   │
│                    │                        │                   │
│                    ▼                        ▼                   │
│                          ┌─────────────────┐                    │
│                          │    complete     │                    │
│                          └─────────────────┘                    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```
